<nav class="fluid-container">
  <a href={~p"/lab-tests/"} style="text-decoration: none">
    ‚Üê <span style="text-decoration: underline">Index of lab tests</span>
  </a>
</nav>

<main class="lab-test-page">
  <h1 class="fluid-container"><%= @lab_test.name %></h1>

  <div class="highlight">
    <article class="fluid-container">
      <div class="highlight-content">
        <%= case @main_obsplot do %>
          <% nil -> %>
            The lab value distribution is not available
          <% obsplot -> %>
            <%= obsplot %>
        <% end %>

        <dl>
          <dt>Number of people</dt>
          <dd><%= @lab_test.npeople_both_sex %> (<%= @lab_test.sex_female_percent %>% female)</dd>

          <dt>Median number of measurements per person</dt>
          <dd><%= @lab_test.median_n_measurements %></dd>

          <dt>Median duration from first to last measurement (years)</dt>
          <dd><%= @lab_test.median_nyears_first_to_last_measurement %></dd>
        </dl>
      </div>
    </article>
  </div>

  <div class="fluid-container">
    <article>
      <h2>Coding</h2>

      <article>
        <h3>Definition</h3>

        <dl>
          <dt>OMOP Concept ID</dt>
          <dd>
            <span class="font-mono"><%= @omop_concept_id %></span>&mdash; open in <%= @link_athena_lab_test %>.
          </dd>

          <dt>Part of collection</dt>
          <dd>
            <%= @parent_loinc_component.concept_name %> with <%= @n_other_in_collection %> other
            OMOP concept<%= if @n_other_in_collection < 2, do: "", else: "s" %> &mdash; open in <%= @link_athena_loinc_component %>.
          </dd>
        </dl>
      </article>
    </article>

    <article>
      <h2>Cohort</h2>

      <dl>
        <dt>Number of people</dt>
        <dd><%= @lab_test.npeople_both_sex %> (<%= @lab_test.sex_female_percent %>% female)</dd>
      </dl>

      <article>
        <h3>Year of birth distribution</h3>
        <figure>
          <%= @lab_test.distribution_year_of_birth %>
        </figure>
      </article>

      <article>
        <h3>Age at first measurement</h3>
        <figure>
          <%= @lab_test.distribution_age_first_measurement %>
        </figure>
      </article>

      <article>
        <h3>Age at last measurement</h3>
        <figure>
          <%= @lab_test.distribution_age_last_measurement %>
        </figure>
      </article>

      <article>
        <h3>Age at start of registry</h3>
        <figure>
          <%= @lab_test.distribution_age_start_of_registry %>
        </figure>
      </article>

      <article>
        <h3>Duration from first to last measurement</h3>
        <figure>
          <%= @lab_test.distribution_ndays_first_to_last_measurement %>
        </figure>
      </article>
    </article>

    <article>
      <h2>Statistics</h2>

      <dl>
        <dt>Median number of measurements per person</dt>
        <dd><%= @lab_test.median_n_measurements %></dd>

        <dt>Median duration from first to last measurement (years)</dt>
        <dd><%= @lab_test.median_nyears_first_to_last_measurement %></dd>
      </dl>

      <article>
        <h3>Distributions of lab values</h3>

        <%= for dist <- @lab_test.distributions_lab_values do %>
          <article class="distribution-lab-values">
            <figure>
              <%= dist.obsplot %>
              <figcaption>
                Distribution of lab values, for data with unit: <%= dist.measurement_unit %>
              </figcaption>
            </figure>
          </article>
        <% end %>
      </article>
    </article>
  </div>
</main>
