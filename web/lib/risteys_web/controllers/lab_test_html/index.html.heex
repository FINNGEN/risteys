<main class="fluid-container lab-tests-page">
  <h1>Index of lab tests</h1>

  <p>Data from FinRegistry.</p>

  <article>
    <h2>Lab tests harmonized with OMOP CDM</h2>

    <div role="grid">
      <div role="row">
        <div role="columnheader" class="header-lab-test">Name</div>
        <div role="columnheader" class="header-npeople">N people</div>
        <div role="columnheader" class="header-sex-ratio">Sex ratio (% female)</div>
        <div role="columnheader" class="header-median-n-measurements">
          Median N&nbsp;measurements per person
        </div>
        <div role="columnheader" class="header-median-duration">
          Median duration from first to last measurement (months)
        </div>
      </div>

      <%= for %{lab_tests: lab_tests} = rec <- @lab_tests_tree_stats do %>
        <div role="rowgroup">
          <div role="row" class="loinc-component">
            <div role="rowheader" title={rec.loinc_component_concept_name}>
              <%= rec.loinc_component_concept_name %>
            </div>
          </div>

          <%= for lab_test <- Enum.map(lab_tests, &index_prettify_stats(&1, @lab_tests_overall_stats)) do %>
            <div role="row" class="lab-test">
              <div
                role="rowheader"
                class="col-lab-test-name"
                title={lab_test.lab_test_concept_name}
              >
                <a href={~p"/lab-tests/" <> lab_test.lab_test_concept_id}>
                  <%= lab_test.lab_test_concept_name %>
                </a>
              </div>

              <div role="gridcell" class="col-npeople numeric"><%= lab_test.npeople_total %></div>

              <div role="gridcell" class="col-npeople-absolute plot">
                <%= lab_test.plot_npeople_absolute %>
              </div>

              <div role="gridcell" class="col-sex-ratio numeric">
                <%= lab_test.sex_female_percent %>
              </div>

              <div role="gridcell" class="col-sex-ratio-plot plot">
                <%= lab_test.plot_sex_female_percent %>
              </div>

              <div role="gridcell" class="col-median-n-measurements numeric">
                <%= lab_test.median_n_measurements %>
              </div>

              <div role="gridcell" class="col-median-n-measurements-plot plot">
                <%= lab_test.plot_median_n_measurements %>
              </div>

              <div role="gridcell" class="col-median-duration numeric">
                <%= lab_test.median_nmonths_first_to_last_measurement %>
              </div>

              <div role="gridcell" class="col-median-duration-plot plot">
                <%= lab_test.plot_median_duration_first_to_last_measurement %>
              </div>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  </article>
</main>
